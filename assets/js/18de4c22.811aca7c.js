"use strict";(self.webpackChunktse_dev_api=self.webpackChunktse_dev_api||[]).push([[1798],{2523:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var s=n(4848),a=n(8453);const i={sidebar_position:12,title:"Excel Power Query Quickstart",slug:"powerquery-quickstart",description:"Excel Power Query Quickstart for the TSE in Cloud APIs",tags:["quickstarts","code example","power query","excel"]},o=void 0,r={id:"stepbystep/quickstarts/excel-powerquery-quickstart",title:"Excel Power Query Quickstart",description:"Excel Power Query Quickstart for the TSE in Cloud APIs",source:"@site/docs/stepbystep/quickstarts/excel-powerquery-quickstart.md",sourceDirName:"stepbystep/quickstarts",slug:"/stepbystep/quickstarts/powerquery-quickstart",permalink:"/develop/docs/stepbystep/quickstarts/powerquery-quickstart",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/stepbystep/quickstarts/excel-powerquery-quickstart.md",tags:[{inline:!0,label:"quickstarts",permalink:"/develop/docs/tags/quickstarts"},{inline:!0,label:"code example",permalink:"/develop/docs/tags/code-example"},{inline:!0,label:"power query",permalink:"/develop/docs/tags/power-query"},{inline:!0,label:"excel",permalink:"/develop/docs/tags/excel"}],version:"current",sidebarPosition:12,frontMatter:{sidebar_position:12,title:"Excel Power Query Quickstart",slug:"powerquery-quickstart",description:"Excel Power Query Quickstart for the TSE in Cloud APIs",tags:["quickstarts","code example","power query","excel"]},sidebar:"tutorialSidebar",previous:{title:"Windows Form Quickstart",permalink:"/develop/docs/stepbystep/quickstarts/windows-form-quickstart"},next:{title:"Google Sheets Apps Script Quickstart",permalink:"/develop/docs/stepbystep/quickstarts/apps-script-quickstart"}},c={},d=[{value:"\ud83d\udcd6\xa0 List Example",id:"open_book-list-example",level:2},{value:"1\ufe0f\u20e3\xa0 Step one: Setup the Data Source",id:"one-step-one-setup-the-data-source",level:3},{value:"2\ufe0f\u20e3\xa0 Step Two: Extract the data",id:"two-step-two-extract-the-data",level:3},{value:"3\ufe0f\u20e3\xa0 Step Three: Enable auto update",id:"three-step-three-enable-auto-update",level:3},{value:"4\ufe0f\u20e3\xa0 Step Four: What about pagination?",id:"four-step-four-what-about-pagination",level:3}];function l(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["In this guide, we'll explain how to use ",(0,s.jsx)(t.em,{children:"Power Query"})," to load contents from our APIs into ",(0,s.jsx)(t.em,{children:"Microsoft Excel"}),"."]}),"\n",(0,s.jsxs)(t.h2,{id:"open_book-list-example",children:["\ud83d\udcd6","\xa0 List Example"]}),"\n",(0,s.jsxs)(t.p,{children:["In this example, we will load our invoices list using the ",(0,s.jsx)(t.a,{href:"/api-reference#get-/c/-company_id-/issued_documents",children:"List Issued Documents"})," method, but you can adapt this guide to using it with the API method you need."]}),"\n",(0,s.jsxs)(t.h3,{id:"one-step-one-setup-the-data-source",children:["1\ufe0f\u20e3","\xa0 Step one: Setup the Data Source"]}),"\n",(0,s.jsx)(t.admonition,{title:"Retrieve your Company ID!",type:"tip",children:(0,s.jsxs)(t.p,{children:["In this example, we'll suppose you have to manage just one Company, so we simply inserted its ID directly in the code. If instead, you need to be able to manage multiple companies, you'll need to retrieve the ID of the current company in some way.\nCheck the ",(0,s.jsx)(t.a,{href:"/basics/company-scoped-methods.mdx",children:"Company-scoped Methods"})," page for more info."]})}),"\n",(0,s.jsxs)(t.p,{children:["First, we must select the ",(0,s.jsx)(t.a,{href:"https://support.microsoft.com/en-us/office/import-data-from-the-web-b13eed81-33fe-410d-9247-1747269c28e4#:~:text=Select%20Data%20%3E%20Get%20%26%20Transform%20%3E,View%20pane%20on%20the%20right.",children:"Import from Web"})," functionality as shown below:"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Get Data From Web",src:n(3232).A+"",width:"744",height:"838"})}),"\n",(0,s.jsxs)(t.p,{children:["Then we need to define the URL that will be contacted by Power Query. The ",(0,s.jsx)(t.a,{href:"/api-reference#get-/c/-company_id-/issued_documents",children:"List Issued Documents"})," method is accessible to the following URL:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"https://api-v2.fattureincloud.it/c/\\{company_id\\}/issued_documents\n"})}),"\n",(0,s.jsxs)(t.p,{children:["additionally, it requires to define some parameters as ",(0,s.jsx)(t.em,{children:"Query String"}),' (e.g. the "?type=invoice" part), but you can substitute it with the endpoint of the method you want. Please, make sure to replace the {company_id} placeholder with your company ID.']}),"\n",(0,s.jsxs)(t.p,{children:["Our APIs require authentication, so we also need to set the ",(0,s.jsx)(t.em,{children:"Authorization header"}),' as shown below. Remember to replace the "YOUR',(0,s.jsx)(t.em,{children:'ACCESS_TOKEN" placeholder with your actual _Access Token'}),"; you can obtain a valid one following ",(0,s.jsx)(t.a,{href:"/authentication/manual-authentication.mdx",children:"this procedure"}),"."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Set the source",src:n(1887).A+"",width:"704",height:"486"})}),"\n",(0,s.jsxs)(t.h3,{id:"two-step-two-extract-the-data",children:["2\ufe0f\u20e3","\xa0 Step Two: Extract the data"]}),"\n",(0,s.jsx)(t.p,{children:"If you inserted the connection parameters correctly, Excel should already have retrieved the method response from our APIs."}),"\n",(0,s.jsx)(t.p,{children:"Now, we have to extract the list of invoices from the API response:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Extract invoices list",src:n(700).A+"",width:"1209",height:"603"})}),"\n",(0,s.jsxs)(t.p,{children:["and then convert the result into a ",(0,s.jsx)(t.em,{children:"Table"})," like shown below:"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.img,{alt:"Convert results to table",src:n(627).A+"",width:"1216",height:"579"}),"\n",(0,s.jsx)(t.img,{alt:"Convert results to table",src:n(1566).A+"",width:"1212",height:"578"})]}),"\n",(0,s.jsxs)(t.p,{children:["Once obtained the table, we must extract the records of the invoices using the ",(0,s.jsx)(t.em,{children:"Record Extractor"}),":"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Extract the invoices",src:n(7536).A+"",width:"1211",height:"575"})}),"\n",(0,s.jsx)(t.p,{children:"then we must select the fields that we are interested in from the menu:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Field selection",src:n(9965).A+"",width:"1211",height:"605"})}),"\n",(0,s.jsx)(t.p,{children:"And finally we can export the records to your sheet:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Export",src:n(607).A+"",width:"1208",height:"579"})}),"\n",(0,s.jsxs)(t.h3,{id:"three-step-three-enable-auto-update",children:["3\ufe0f\u20e3","\xa0 Step Three: Enable auto update"]}),"\n",(0,s.jsxs)(t.p,{children:["Using Power Query it is possible to activate periodic updates of the data, selecting the ",(0,s.jsx)(t.strong,{children:"query -> properties -> check the 'update every x minutes'"})," functionality as shown below."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Auto update",src:n(9786).A+"",width:"886",height:"660"})}),"\n",(0,s.jsxs)(t.h3,{id:"four-step-four-what-about-pagination",children:["4\ufe0f\u20e3","\xa0 Step Four: What about pagination?"]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.a,{href:"/api-reference#get-/c/-company_id-/issued_documents",children:"List Issued Documents"})," response is ",(0,s.jsx)(t.a,{href:"/develop/docs/basics/additional-capabilities/paginate-results",children:"paginated"}),", this means that the results will be split into different sets; each set will contain a certain number of records up to the maximum value as explained on the dedicated page. Until now we just fetched the first page from the API, and this means that to retrieve the whole result we need to ",(0,s.jsx)(t.em,{children:"manage pagination"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"Unluckily it is not trivial, so you have to open advanced the Power Query editor and paste in the following code"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:'let\n    Source = Json.Document(\n        Web.Contents(\n            url,\n            [\n                Timeout = #duration(0, 0, 1, 0),\n                Headers = [Authorization = "Bearer YOUR_ACCESS_TOKEN"]\n            ]\n        )\n    ),\n    iterations = Source[last_page],\n    url = "https://api-v2.fattureincloud.it/c/\\{company_id\\}/issued_documents" & "?" & "type=invoice",\n\n    FnGetOnePage =\n    (url) as record =>\n    let\n        Source = Json.Document(\n            Web.Contents(\n                url,\n                [\n                    Timeout = #duration(0, 0, 1, 0),\n                    Headers = [Authorization = "Bearer YOUR_ACCESS_TOKEN"]\n                ]\n            )\n        ),\n        data = try Source[data] otherwise null,\n        next = try Source[next_page_url] otherwise null,\n        res = [Data = data, Next = next]\nin\nres,\nGeneratedList =\n    List.Generate(\n        () => [i = 0, res = FnGetOnePage(url)],\n        each[i] < iterations and[res][Data] <> null,\n        each[i = [i] + 1, res = FnGetOnePage([res][Next])],\n        each[res][Data]),\n    #"Table conversion" = Table.FromList(GeneratedList, Splitter.SplitByNothing(), null, null, ExtraValues.Error),\n    #"Expanded list" = Table.ExpandListColumn(#"Table conversion", "Column1"),\n    #"Expanded Records" = Table.ExpandRecordColumn(#"Expanded list", "Column1", {\n        "id",\n        "type",\n        "numeration",\n        "subject",\n        "visible_subject",\n        "amount_net",\n        "amount_vat",\n        "amount_gross",\n        "date",\n        "number",\n        "next_due_date",\n        "url",\n        "entity"\n    }, {\n        "id",\n        "type",\n        "numeration",\n        "subject",\n        "visible_subject",\n        "amount_net",\n        "amount_vat",\n        "amount_gross",\n        "date",\n        "number",\n        "next_due_date",\n        "url",\n        "entity"\n    }),\n    #"Expanded Entity" = Table.ExpandRecordColumn(#"Expanded Records", "entity", {\n        "name",\n        "tax_code",\n        "vat_number"\n    }, {\n        "client.name",\n        "client.tax_code",\n        "client.vat_number"\n    })\nin\n#"Expanded Entity"\n'})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Advanced query",src:n(1270).A+"",width:"1208",height:"554"})}),"\n",(0,s.jsx)(t.p,{children:"The code above loops all the pages of the response and aggregates the results; additionally, it extracts the entity field to show the client name, tax_code and vat_number.\nTo use this code you mustreplace the placeholders 'YOUR_ACCESS_TOKEN' and {company_id} as explained previously."}),"\n",(0,s.jsxs)(t.p,{children:["Please, notice that this will increment the number of API requests executed, so you must be sure to not hit the ",(0,s.jsx)(t.a,{href:"/develop/docs/basics/limits-and-quotas",children:"quota limits"})," to avoid the related errors."]})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},1270:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/advanced_query-914ed79a79c26d5e0a55deafd1d33618.png"},9786:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/automatic_update-7c56db32debb13553a3274ec5bcbd7c5.png"},627:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/convert_to_table-875950bab9bef92fb8f2b0fc74edd549.png"},1566:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/convert_to_table_step2-ab8baf16f81f6b04ce9c32c5adc10903.png"},607:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/export-8f2b1d883a0b81a1ba7d7bd2d53b8a8d.png"},700:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/extract_invoices_list-ebe4160d7540eab789f1538783079d1c.png"},7536:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/extract_single_invoices-7aa006ef91ca5198c9a4efa055b002fe.png"},3232:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/get_data_from_web-47ec53e4c8aae2c2b6a62ad40be93cf9.png"},9965:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/select_fields-615b85bcc3d8b5ee4d63eb84375a551a.png"},1887:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/set_source_url-166221ecd864dfd09be0ba37f37fc340.png"},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var s=n(6540);const a={},i=s.createContext(a);function o(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);